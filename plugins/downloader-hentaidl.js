//var _0x50a9=["\x6E\x6F\x64\x65\x2D\x66\x65\x74\x63\x68","\x63\x68\x65\x65\x72\x69\x6F","\x6A\x73\x64\x6F\x6D","\x72\x65\x70\x6C\x79","\x45\x6A\x65\x6D\x70\x6C\x6F\x20\x64\x65\x20\x75\x73\x6F\x3A\x20\x68\x65\x6E\x74\x20\x42\x6F\x6B\x75\x20\x6E\x69\x20\x48\x61\x72\x65\x6D\x20\x53\x65\x78\x66\x72\x69\x65\x6E\x64","\x63\x68\x61\x74","\x72\x65\x61\x63\x74","\x68\x74\x74\x70\x73\x3A\x2F\x2F\x76\x65\x6F\x68\x65\x6E\x74\x61\x69\x2E\x63\x6F\x6D\x2F\x76\x65\x72\x2F","\x69\x6E\x63\x6C\x75\x64\x65\x73","\x67\x65\x74\x49\x6E\x66\x6F","\x6E\x6F\x20\x73\x65\x20\x65\x6E\x63\x6F\x6E\x74\x72\x6F\x20\x69\x6E\x66\x6F\x72\x6D\x61\x63\x69\xC3\xB3\x6E\x20\x64\x65\x6C\x20\x76\x69\x64\x65\x6F\x2E","\x76\x69\x64\x65\x6F\x55\x72\x6C","\x73\x69\x7A\x65","\x54\x69\x74\x6C\x65\x20\x3A","\x56\x69\x65\x77\x73\x20\x3A","\x4C\x69\x6B\x65\x73\x20\x3A","\x50\x65\x73\x6F\x20\x3A","\x44\x69\x73\x6C\x69\x6B\x65\x73\x20\x3A","\x4C\x69\x6E\x6B\x20\x3A","\x74\x65\x78\x74","\x63\x6F\x6E\x74\x65\x78\x74\x49\x6E\x66\x6F","\x65\x78\x74\x65\x72\x6E\x61\x6C\x41\x64\x52\x65\x70\x6C\x79","\x74\x69\x74\x6C\x65","\x44\x65\x73\x63\x61\x72\x67\x61\x72\x20\x76\x69\x64\x65\x6F","\x74\x68\x75\x6D\x62\x6E\x61\x69\x6C","\x73\x6F\x75\x72\x63\x65\x55\x72\x6C","\x6D\x65\x64\x69\x61\x54\x79\x70\x65","\x72\x65\x6E\x64\x65\x72\x4C\x61\x72\x67\x65\x72\x54\x68\x75\x6D\x62\x6E\x61\x69\x6C","\x73\x65\x6E\x64\x4D\x65\x73\x73\x61\x67\x65","\x71\x75\x6F\x74\x65\x64","\x73\x65\x6E\x64\x46\x69\x6C\x65","\x6D\x70\x34","\x73\x65\x61\x72\x63\x68\x48\x65\x6E\x74\x61\x69","\x4E\x6F\x20\x73\x65\x20\x65\x6E\x63\x6F\x6E\x74\x72\x6F\x6E\x20\x72\x65\x73\x75\x6C\x74\x61\x64\x6F\x73\x2E","\x6C\x65\x6E\x67\x74\x68","\x52\x65\x73\x75\x6C\x74\x61\x64\x6F\x73\x20\x64\x65\x20\x62\x75\x73\x71\x75\x65\x64\x61","\x56\x65\x6F\x68\x65\x6E\x74\x61\x69","\x72\x65\x64\x65\x73","\x45\x72\x72\x6F\x72\x20\x65\x6E\x20\x6C\x61\x20\x65\x6A\x65\x63\x75\x63\x69\xC3\xB3\x6E\x2E\x0A\x0A","\x68\x65\x6C\x70","\x63\x6F\x6D\x6D\x61\x6E\x64","\x68\x65\x6E\x74\x61\x69","\x68\x65\x6E\x74","\x68\x65\x6E\x74\x61\x69\x64\x6C","\x68\x74\x64\x6C","\x74\x61\x67\x73","\x64\x65\x73\x63\x61\x72\x67\x61\x64\x61\x73","\x64\x69\x61\x6D\x6F\x6E\x64","\x68\x74\x74\x70\x73\x3A\x2F\x2F\x76\x65\x6F\x68\x65\x6E\x74\x61\x69\x2E\x63\x6F\x6D\x2F\x3F\x73\x3D","\x65\x6E\x63\x6F\x64\x65\x55\x52\x49\x43\x6F\x6D\x70\x6F\x6E\x65\x6E\x74","\x6F\x6B","\x45\x72\x72\x6F\x72\x20\x65\x6E\x20\x6C\x61\x20\x70\x65\x74\x69\x63\x69\xC3\xB3\x6E\x3A\x20","\x73\x74\x61\x74\x75\x73","\x74\x65\x78\x74","\x6C\x6F\x61\x64","\x67\x72\x69\x64","\x65\x61\x63\x68","\x61\x74\x74\x72","\x68\x32","\x74\x65\x78\x74\x43\x6F\x6E\x74\x65\x6E\x74","\x74\x72\x69\x6D","\x65\x72\x72\x6F\x72","\x68\x65\x61\x64\x65\x72\x73","\x55\x73\x65\x72\x2D\x41\x67\x65\x6E\x74","\x64\x6F\x63\x75\x6D\x65\x6E\x74","\x71\x75\x65\x72\x79\x53\x65\x6C\x65\x63\x74\x6F\x72","\x61\x73\x70\x65\x63\x74\x2D\x77\x2D\x31\x36\x2E\x61\x73\x70\x65\x63\x74\x2D\x68\x2D\x39\x20\x69\x66\x72\x61\x6D\x65","\x73\x72\x63","\x76\x69\x64\x65\x6F\x48\x74\x6D\x6C","\x6D\x61\x74\x63\x68","\x6E\x6F\x20\x73\x65\x20\x65\x6E\x63\x6F\x6E\x74\x72\xC3\xB3\x20\x6C\x61\x20\x55\x52\x4C\x20\x64\x65\x6C\x20\x76\x69\x64\x65\x6F","\x61\x74\x6F\x62","\x68\x31\x2E\x74\x65\x78\x74\x2D\x77\x68\x69\x74\x65\x67\x72\x61\x79\x2E\x74\x65\x78\x74\x2D\x6C\x67","\x68\x34\x2E\x74\x65\x78\x74\x2D\x77\x68\x69\x74\x65\x6C\x69\x74\x65\x2E\x74\x65\x78\x74\x2D\x73\x6D","\x23\x6E\x75\x6D\x2D\x6C\x69\x6B\x65","\x23\x6E\x75\x6D\x2D\x64\x69\x73\x6C\x69\x6B\x65","\x6D\x65\x74\x68\x6F\x64","\x48\x45\x41\x44","\x67\x65\x74","\x70\x61\x72\x73\x65\x49\x6E\x74","\x63\x6F\x6E\x74\x65\x6E\x74\x2D\x6C\x65\x6E\x67\x74\x68","\x53\x69\x7A\x65\x20\x6E\x6F\x74\x20\x61\x76\x61\x69\x6C\x61\x62\x6C\x65","\x20\x47\x42","\x20\x4D\x42","\x20\x4B\x42","\x20\x42\x79\x74\x65\x73","\x45\x72\x72\x6F\x72\x3A\x20","\x6C\x65\x6E\x67\x74\x68"];import fetch from _0x50a9[0];import cheerio from _0x50a9[1];import{JSDOM:JSDOM}from _0x50a9[2];let handler=async(_0x50a9x2,{conn:_0x50a9x3,text:_0x50a9x4,args:_0x50a9x5,setting:_0x50a9x6})=>{try{if(!_0x50a9x4){return _0x50a9x3[_0x50a9[3]](_0x50a9x2[_0x50a9[5]],_0x50a9[4],_0x50a9x2)}_0x50a9x2[_0x50a9[6]]('\xF0\x9F\x95\x92');if(_0x50a9x4[_0x50a9[8]](_0x50a9[7])){const _0x50a9x7=await getInfo(_0x50a9x4);if(!_0x50a9x7){return _0x50a9x3[_0x50a9[3]](_0x50a9x2[_0x50a9[5]],_0x50a9[10],_0x50a9x2)}const _0x50a9x8=_0x50a9x7[_0x50a9[11]];let _0x50a9x9=await size(_0x50a9x7[_0x50a9[11]]);let _0x50a9xa="\x0A\x21\x20\x48\x65\x6E\x74\x61\x69\x20\x2D\x20\x44\x6F\x77\x6E\x6C\x6F\x61\x64\x20\x21\x0A\x0A\xE2\x89\xA1\x20\x60\x54\x69\x74\x6C\x65\x20\x3A\x60\x20"+_0x50a9x7[_0x50a9[22]]+"\x0A\xE2\x89\xA1\x20\x60\x56\x69\x65\x77\x73\x20\x3A\x60\x20"+_0x50a9x7[_0x50a9[70]]+"\x0A\xE2\x89\xA1\x20\x60\x4C\x69\x6B\x65\x73\x20\x3A\x60\x20"+_0x50a9x7[_0x50a9[71]]+"\x0A\xE2\x89\xA1\x20\x60\x50\x65\x73\x6F\x20\x3A\x60\x20"+_0x50a9x9+"\x0A\xE2\x89\xA1\x20\x60\x44\x69\x73\x6C\x69\x6B\x65\x73\x20\x3A\x60\x20"+_0x50a9x7[_0x50a9[72]]+"\x0A\xE2\x89\xA1\x20\x60\x4C\x69\x6E\x6B\x20\x3A\x60\x20"+_0x50a9x4+"\x0A";_0x50a9x3[_0x50a9[29]](_0x50a9x2[_0x50a9[5]],{text:_0x50a9xa,contextInfo:{externalAdReply:{title:_0x50a9x7[_0x50a9[22]],body:_0x50a9[23],thumbnail:imagen1,sourceUrl:_0x50a9x4,mediaType:0x1,renderLargerThumbnail:true}}},{quoted:_0x50a9x2});await _0x50a9x3[_0x50a9[31]](_0x50a9x2[_0x50a9[5]],_0x50a9x8,_0x50a9x7[_0x50a9[22]]+_0x50a9[32],_0x50a9x2,{document:true});_0x50a9x2[_0x50a9[6]]('\xE2\x9D\x8C')}else{const _0x50a9xb=await searchHentai(_0x50a9x4);if(_0x50a9xb[_0x50a9[91]]===0x0){return _0x50a9x3[_0x50a9[3]](_0x50a9x2[_0x50a9[5]],_0x50a9[34],_0x50a9x2)}let _0x50a9xc="\x0A\x21\x20\x48\x65\x6E\x74\x61\x69\x20\x2D\x20\x53\x65\x61\x72\x63\x68\x20\x21\x0A";_0x50a9xb[_0x50a9[56]](0x0,0xF)[_0x50a9[57]]((_0x50a9xe,_0x50a9xf)=>{_0x50a9xc+="\x0A\x60"+(_0x50a9xf+0x1)+"\x60\x0A\xE2\x89\xA1\x20\x60\x54\x69\x74\x6C\x65\x20\x3A\x60\x20"+_0x50a9xe[_0x50a9[59]]+"\x0A\xE2\x89\xA1\x20\x60\x4C\x69\x6E\x6B\x20\x3A\x60\x20"+_0x50a9xe[_0x50a9[62]]+"\x0A"});_0x50a9x3[_0x50a9[29]](_0x50a9x2[_0x50a9[5]],{text:_0x50a9xc,contextInfo:{externalAdReply:{title:_0x50a9[36],body:_0x50a9[37],thumbnail:imagen1,sourceUrl:redes,mediaType:0x1,renderLargerThumbnail:true}}},{quoted:_0x50a9x2});_0x50a9x2[_0x50a9[6]]("\xF0\x9F\x94\x9E")}}catch(_0x50a9x10){return _0x50a9x3[_0x50a9[3]](_0x50a9x2[_0x50a9[5]],_0x50a9[39]+_0x50a9x10,_0x50a9x2)}};handler[_0x50a9[40]]=[_0x50a9[42]];handler[_0x50a9[41]]=[_0x50a9[42],_0x50a9[43],_0x50a9[44],_0x50a9[45]];handler[_0x50a9[46]]=[_0x50a9[47]];handler[_0x50a9[48]]=true;handler[_0x50a9[49]]=true;export default handler;async function searchHentai(_0x50a9x11){let _0x50a9x12=_0x50a9[50]+_0x50a9[51](_0x50a9x11);try{const _0x50a9x13=await fetch(_0x50a9x12);if(!_0x50a9x13[_0x50a9[52]])throw new Error(_0x50a9[53]+_0x50a9x13[_0x50a9[54]]);const _0x50a9x14=await _0x50a9x13[_0x50a9[55]]();const _0x50a9x15=cheerio[_0x50a9[56]](_0x50a9x14);let _0x50a9x16=[];_0x50a9x15(_0x50a9[58])[_0x50a9[57]]((_0x50a9x17,_0x50a9x18)=>{let _0x50a9x19=_0x50a9x15(_0x50a9x18)[_0x50a9[60]](_0x50a9[61]);let _0x50a9x1a=_0x50a9x15(_0x50a9x18)[_0x50a9[62]](_0x50a9[63])[_0x50a9[64]]();if(_0x50a9x19&&_0x50a9x1a){_0x50a9x16[_0x50a9[90]]({titulo:_0x50a9x1a,url:_0x50a9x19})}});return _0x50a9x16}catch(_0x50a9x1b){console[_0x50a9[65]](_0x50a9[66],_0x50a9x1b);return[]}}async function getInfo(_0x50a9x1c){try{const _0x50a9x1d=await fetch(_0x50a9x1c,{headers:{_0x50a9[67]:_0x50a9[68]}});const _0x50a9x1e=await _0x50a9x1d[_0x50a9[55]]();const _0x50a9x1f=new JSDOM(_0x50a9x1e);const _0x50a9x20=_0x50a9x1f[_0x50a9[69]];const _0x50a9x21=_0x50a9x20[_0x50a9[70]](_0x50a9[71]);if(_0x50a9x21){const _0x50a9x22=_0x50a9x21[_0x50a9[72]];const _0x50a9x23=await fetch(_0x50a9x22);const _0x50a9x24=await _0x50a9x23[_0x50a9[55]]();const _0x50a9x25=_0x50a9x24[_0x50a9[73]](/\x64\x61\x74\x61\x2D\x69\x64\x3D\x22\x5C\x2F\x70\x6C\x61\x79\x65\x72\x5C\x2E\x70\x68\x70\x5C\x3F\x75\x3D\x28[\x5E\x26]*\x29/);if(!_0x50a9x25)throw new Error(_0x50a9[74]);const _0x50a9x8=atob(_0x50a9x25[0x1]);const _0x50a9x7=_0x50a9x20[_0x50a9[70]](_0x50a9[75])[_0x50a9[64]]();const _0x50a9x26=_0x50a9x20[_0x50a9[70]](_0x50a9[76])[_0x50a9[64]]();const _0x50a9x27=_0x50a9x20[_0x50a9[70]](_0x50a9[77])[_0x50a9[64]]();const _0x50a9x28=_0x50a9x20[_0x50a9[70]](_0x50a9[78])[_0x50a9[64]]();return{videoUrl:_0x50a9x8,title:_0x50a9x7,views:_0x50a9x26,likes:_0x50a9x27,dislikes:_0x50a9x28}}else{return null}}catch(_0x50a9x1b){console[_0x50a9[65]](_0x50a9x1b);return null}}async function size(_0x50a9x29){try{const _0x50a9x2a=await fetch(_0x50a9x29,{method:_0x50a9[79]});const _0x50a9x2b=parseInt(_0x50a9x2a[_0x50a9[67]][_0x50a9[80]](_0x50a9[81]),0xa);if(!_0x50a9x2b)throw new Error(_0x50a9[82]);if(_0x50a9x2b>=0x3B9ACA00)return(_0x50a9x2b/0x3B9ACA00)[_0x50a9[90]](0x2)+_0x50a9[83];if(_0x50a9x2b>=0xF4240)return(_0x50a9x2b/0xF4240)[_0x50a9[90]](0x2)+_0x50a9[84];if(_0x50a9x2b>=0x3E8)return(_0x50a9x2b/0x3E8)[_0x50a9[90]](0x2)+_0x50a9[85];return _0x50a9x2b+_0x50a9[86]}catch(_0x50a9x1b){return _0x50a9[87]+_0x50a9x1b[_0x50a9[22]]}}


import fetch from "node-fetch";
import cheerio from "cheerio";
import { JSDOM } from "jsdom";

let handler = async (m, { conn, text, args, setting, usedPrefix, command }) => {
  try {
    if (!text) {
      return conn.reply(m.chat, `Ejemplo de uso: hent Boku ni Harem Sexfriend`, m, rcanal);
    }

    m.react('ðŸ•’');

    if (text.includes('https://veohentai.com/ver/')) {
      const videoInfo = await getInfo(text);
      if (!videoInfo) {
        return conn.reply(m.chat, 'No se encontrÃ³ informaciÃ³n del video.', m, rcanal);
      }

      const videoUrl = videoInfo.videoUrl;
      let peso = await size(videoInfo.videoUrl);

      let cap = `
â—œ Hentai - Download â—ž

â‰¡ \`Title :\` ${videoInfo.title}
â‰¡ \`Views :\` ${videoInfo.views}
â‰¡ \`Likes :\` ${videoInfo.likes}
â‰¡ \`Peso :\` ${peso}
â‰¡ \`Dislikes :\` ${videoInfo.dislikes}
â‰¡ \`Link :\` ${text}
`;

      conn.sendMessage(m.chat, { text: cap,
        contextInfo: {
          externalAdReply: {
            title: videoInfo.title,
            body: "Descargar video",
            thumbnail: 'https://files.catbox.moe/ldiqpu.jpg',
            sourceUrl: 'https://dash.host-cuervo.shop',
            mediaType: 1,
            renderLargerThumbnail: true
          }
        }
      }, { quoted: m });

      await conn.sendFile(m.chat, videoUrl, `${videoInfo.title}.mp4`, '', m, {
        document: true
      });
      m.react('â˜‘ï¸');
        const nombre = await conn.getName(m.sender)
        await conn.sendMessage(channelid, { text: `â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â¦\nâ”‚â•­âžŸ â‰¡ El Usuario ${nombre}\nâ”‚â”‚âžŸ â–¢ A Usado El Comando ${usedPrefix + command}\nâ”‚â•°âžŸ âŒ¬ áŽ¡ê­¼ê®‡ áŸê®‹ê­ºÉ´ áŽ³ê®‹ê­º - á´ê®»ê­²`, contextInfo: {
externalAdReply: {
title: "ã€ ðŸ”” ð—¡ð—¢ð—§ð—œð—™ð—œð—–ð—”ð—–ð—œð—¢Ìð—¡ ðŸ”” ã€‘",
body: 'ðŸ¤– Uso De Un Comando ðŸ“¥',
thumbnailUrl: 'https://files.catbox.moe/qtdb1u.jpg',
sourceUrl: 'https://dash.host-cuervo.shop',
mediaType: 1,
showAdAttribution: false,
renderLargerThumbnail: false
}}}, { quoted: null })
    } else {
      const results = await searchHentai(text);
      if (results.length === 0) {
        return conn.reply(m.chat, 'No se encontraron resultados.', m, rcanal);
      }

      let cap = `â—œ Hentai - Search â—ž\n`;

      results.slice(0, 15).forEach((res, index) => {
        cap += `\n\`${index + 1}\`\nâ‰¡ \`Title :\` ${res.titulo}\nâ‰¡ \`Link :\` ${res.url}\n`;
      });

      conn.sendMessage(m.chat, { text: cap,
        contextInfo: {
          externalAdReply: {
            title: "Resultados de bÃºsqueda",
            body: "Veohentai",
            thumbnail: 'https://files.catbox.moe/qtdb1u.jpg',
            sourceUrl: 'https://dash.host-cuervo.shop',
            mediaType: 1,
            renderLargerThumbnail: true
          }
        }
      }, { quoted: m });

      m.react("ðŸ”ž");
    }
  } catch (err) {
    return conn.reply(m.chat, 'Error en la ejecuciÃ³n.\n\n' + err, m, rcanal);
  }
};

handler.help = ["hentai"];
handler.command = ["hentai", "hent", "hentaidl", "htdl"];
handler.tags = ["dl"];
handler.group = true;

export default handler;

async function searchHentai(text) {
  let base = `https://veohentai.com/?s=${encodeURIComponent(text)}`;

  try {
    const response = await fetch(base);
    if (!response.ok) throw new Error(`Error en la peticiÃ³n: ${response.status}`);

    const html = await response.text();
    const $ = cheerio.load(html);

    let resultados = [];

    $(".grid a").each((i, el) => {
      let url = $(el).attr("href");
      let titulo = $(el).find("h2").text().trim();

      if (url && titulo) {
        resultados.push({ titulo, url });
      }
    });

    return resultados;
  } catch (error) {
    console.error("Error:", error);
    return [];
  }
}

async function getInfo(url) {
  try {
    const response = await fetch(url, {
      headers: { "User-Agent": "Mozilla/5.0" }
    });

    const data = await response.text();
    const dom = new JSDOM(data);
    const document = dom.window.document;

    const iframe = document.querySelector(".aspect-w-16.aspect-h-9 iframe");

    if (iframe) {
      const iframeSrc = iframe.src;
      const videoResponse = await fetch(iframeSrc);
      const videoHtml = await videoResponse.text();
      const match = videoHtml.match(/data-id="\/player\.php\?u=([^&]*)/);

      if (!match) throw new Error("No se encontrÃ³ la URL del video");

      const videoUrl = atob(match[1]);

      const title = document.querySelector("h1.text-whitegray.text-lg").textContent.trim();
      const views = document.querySelector("h4.text-whitelite.text-sm").textContent.trim();
      const likes = document.querySelector("#num-like").textContent.trim();
      const dislikes = document.querySelector("#num-dislike").textContent.trim();

      return {
        videoUrl,
        title,
        views,
        likes,
        dislikes
      };
    } else {
      return null;
    }
  } catch (error) {
    console.error(error);
    return null;
  }
}

async function size(url) {
  try {
    const res = await fetch(url, { method: 'HEAD' });
    const size = parseInt(res.headers.get('content-length'), 10);

    if (!size) throw new Error('Size not available');

    if (size >= 1e9) return (size / 1e9).toFixed(2) + ' GB';
    if (size >= 1e6) return (size / 1e6).toFixed(2) + ' MB';
    if (size >= 1e3) return (size / 1e3).toFixed(2) + ' KB';
    return size + ' Bytes';
  } catch (err) {
    return 'Error: ' + err.message;
  }
}
